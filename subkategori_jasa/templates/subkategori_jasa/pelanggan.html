<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subkategori Jasa Pelanggan</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>

</head>
<body>
    <div class="container mt-4">
        <h1 class="text-center">{{ kategori.nama_kategori }}: {{ subkategori.nama_subkategori }}</h1>
        <p class="text-center">{{ subkategori.deskripsi }}</p>

        <!-- Sesi Layanan -->
        <h2>Sesi Layanan</h2>
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th style="text-align: center;">Sesi Layanan</th>
                        <th style="text-align: center;">Harga</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    {% for sesi in sesi_layanan %}
                    <tr>
                        <td style="text-align: center;">{{ sesi.sesi }}</td>
                        <td style="text-align: center;">Rp {{ sesi.harga|floatformat:2 }}</td>
                        <td>
                            <button 
                                class="btn btn-primary" 
                                data-bs-toggle="modal" 
                                data-bs-target="#pesanModal" 
                                data-sesi="{{ sesi.sesi }}" 
                                data-harga="{{ sesi.harga }}">
                                Pesan
                            </button>
                        
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
                
            </table>
        </div>

        <!--ini otw ganti, link dari url aja-->
        <!-- Daftar Pekerja -->
        <h2 class="mt-5">Pekerja</h2>
        <div class="row">
            {% for pekerja in pekerja_list %}
            <div class="col-md-3">
                <div class="card mb-4">
                    <img src="{{ pekerja.link_foto }}" class="card-img-top" alt="{{ pekerja.nama }}">
                    <div class="card-body">
                        <h5 class="card-title">{{ pekerja.nama }}</h5>
                        <p class="card-text">Rating: {{ pekerja.rating }}/5</p>
                        <a href="{% url 'subkategori_jasa:profil_pekerja' pekerja.id %}" class="btn btn-primary">Lihat Profil</a>  <!--otw revisi redirect-nya-->
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        


        <!-- Testimoni -->
        <h2 class="mt-5">Testimoni</h2>
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th style="text-align: center;">Nama Pengguna</th>
                        <th style="text-align: center;">Teks Testimoni</th>
                        <th style="text-align: center;">Tanggal</th>
                        <th style="text-align: center;">Nama Pekerja</th>
                        <th style="text-align: center;">Rating</th>
                    </tr>
                </thead>
                <tbody>
                    {% for testi in testimoni %}
                    <tr>
                        <td style="text-align: center;" >{{ testi.nama_pengguna }}</td>
                        <td>{{ testi.teks }}</td>
                        <td style="text-align: center;">{{ testi.tgl|date:"d-m-Y" }}</td>
                        <td style="text-align: center;">{{ testi.nama_pekerja }}</td>
                        <td style="text-align: center;">{{ testi.rating }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>            
        </div>
        
        <!-- Modal Pesan Jasa -->
        <div class="modal fade" id="pesanModal" tabindex="-1" aria-labelledby="pesanModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <form method="post" action="{% url 'subkategori_jasa:buat_pemesanan_jasa' %}">
                        {% csrf_token %}
                        <div class="modal-header">
                            <h5 class="modal-title" id="pesanModalLabel">Pesan Jasa</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <!-- Tanggal Pemesanan -->
                            <div class="mb-3">
                                <label for="tanggal_pemesanan" class="form-label">Tanggal Pemesanan</label>
                                <input type="date" class="form-control" id="tanggal_pemesanan" name="tanggal_pemesanan" required>
                            </div>
                            <!-- Kode Diskon -->
                            <div class="mb-3">
                                <label for="kode_diskon" class="form-label">Diskon</label>
                                <input type="text" class="form-control" id="kode_diskon" name="kode_diskon" placeholder="Masukkan kode diskon">
                            </div>
                            <!-- Total Biaya -->
                            <div class="mb-3">
                                <label for="total_biaya" class="form-label">Total Pembayaran</label>
                                <input type="text" class="form-control" id="total_biaya" readonly>
                            </div>
                            <!-- Metode Pembayaran -->
                            <div class="mb-3">
                                <label for="metode_bayar" class="form-label">Metode Pembayaran</label>
                                <select class="form-select" id="metode_bayar" name="metode_bayar" required>
                                    {% for metode in metode_bayar_list %}
                                    <option value="{{ metode.id }}">{{ metode.nama }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <!-- Hidden Inputs -->
                            <input type="hidden" id="modal-sesi" name="sesi">
                            <input type="hidden" id="modal-harga" name="harga">
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                            <button type="submit" class="btn btn-primary">Pesan Jasa</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

    

        <script>
            const pesanModal = document.getElementById('pesanModal');
            pesanModal.addEventListener('show.bs.modal', function (event) {
                const button = event.relatedTarget;
                const sesi = button.getAttribute('data-sesi');
                const harga = button.getAttribute('data-harga');
        
                document.getElementById('modal-sesi').value = sesi;
                document.getElementById('modal-harga').value = harga;
                document.getElementById('total_biaya').value = `Rp ${parseFloat(harga).toLocaleString('id-ID')}`;
            });
        </script>
        
        
          

</body>
</html>
